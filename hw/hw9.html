<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.242">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shao-Ting Chiu (UIN:433002162)">
<meta name="dcterms.date" content="2023-01-20">

<title>STAT638: Applied Bayesian Methods - 13&nbsp; Homework 9</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../hw/hw10.html" rel="next">
<link href="../hw/hw8.html" rel="prev">
<link href="../img/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STAT638: Applied Bayesian Methods</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/stevengogogo/STAT638_Applied-Bayes-Methods"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Homework 9</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true"><strong>Lecture Notes</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Chapter 1 Introduction and examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Chapter 2: Conditional distributions and Bayes rule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Chapter 3: One-parameter models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 4: Monte Carlo Approximation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true"><strong>Assignments</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Homework 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Homework 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Homework 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Homework 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Homework 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Homework 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw8.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Homework 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw9.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Homework 9</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw10.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Homework 10</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ref.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#computational-environment" id="toc-computational-environment" class="nav-link active" data-scroll-target="#computational-environment"><span class="toc-section-number">13.1</span>  Computational Environment</a></li>
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description"><span class="toc-section-number">13.2</span>  Description</a></li>
  <li><a href="#problem-9.1" id="toc-problem-9.1" class="nav-link" data-scroll-target="#problem-9.1"><span class="toc-section-number">13.3</span>  Problem 9.1</a>
  <ul class="collapse">
  <li><a href="#a" id="toc-a" class="nav-link" data-scroll-target="#a"><span class="toc-section-number">13.3.1</span>  (a)</a></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b"><span class="toc-section-number">13.3.2</span>  (b)</a></li>
  </ul></li>
  <li><a href="#problem-9.2" id="toc-problem-9.2" class="nav-link" data-scroll-target="#problem-9.2"><span class="toc-section-number">13.4</span>  Problem 9.2</a>
  <ul class="collapse">
  <li><a href="#a-1" id="toc-a-1" class="nav-link" data-scroll-target="#a-1"><span class="toc-section-number">13.4.1</span>  (a)</a></li>
  <li><a href="#b-1" id="toc-b-1" class="nav-link" data-scroll-target="#b-1"><span class="toc-section-number">13.4.2</span>  (b)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Homework 9</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading"></div>
  
    <div class="quarto-title-meta-contents">
    <a href="stchiu@email.tamu.edu">Shao-Ting Chiu (UIN:433002162)</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Electrical and Computer Engineering, Texas A&amp;M University
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="computational-environment" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="computational-environment"><span class="header-section-number">13.1</span> Computational Environment</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="st">"hw9"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DelimitedFiles</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ProtoStructs</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Random</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">2022</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Activating project at `~/Documents/GitHub/STAT638_Applied-Bayes-Methods/hw/hw9`</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Random.TaskLocalRNG()</code></pre>
</div>
</div>
</section>
<section id="description" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="description"><span class="header-section-number">13.2</span> Description</h2>
<ul>
<li>Course: STAT638, 2022 Fall</li>
<li>Deadline: 2022/11/17, 12:00 pm</li>
</ul>
<blockquote class="blockquote">
<p>Read Chapter 9 in the Hoff book. Then do Problems 9.1 and 9.2 in Hoff.</p>
<p>For both regression models, please include an intercept term (<span class="math inline">\(\beta_0\)</span>).</p>
<p>In 9.1(b), please replace “max” by “min”. (This is not listed in the official book errata, but appears to be a typo.)</p>
<p>For 9.2, the azdiabetes.dat data are described in <em>Exercise</em> 6 of Chapter 7 (see errata).</p>
</blockquote>
<ul>
<li>Note: This PDF file is generated by Quarto and LualaTeX. There is unsolved problem to display the special character in the source code. Thus, I leave the html version here for reference that displays the complete source code:</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://stchiu.quarto.pub/stat_638_hw_9/">https://stchiu.quarto.pub/stat_638_hw_9/</a></p>
</blockquote>
</section>
<section id="problem-9.1" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="problem-9.1"><span class="header-section-number">13.3</span> Problem 9.1</h2>
<blockquote class="blockquote">
<p>Extrapolation: The file <code>swim.dat</code> contains data on the amount of time in seconds, it takes each of four high school swimmers to swim <span class="math inline">\(50\)</span> yards. Each swimmer has <span class="math inline">\(6\)</span> times, taken on a biweekly basis.</p>
</blockquote>
<section id="a" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="a"><span class="header-section-number">13.3.1</span> (a)</h3>
<blockquote class="blockquote">
<p>Perform the following data analysis for each swimmer separately:</p>
<ol type="1">
<li>Fit a linear regression model of swimming time as the response and week as the explanatory variable. To formulate your prior, use the information that competitive times for this age group generally range from <span class="math inline">\(22\)</span> to <span class="math inline">\(24\)</span> seconds.</li>
<li>For each swimmer <span class="math inline">\(j\)</span>, obtain a posterior predictive distribution for <span class="math inline">\(Y^{*}_j\)</span>, their time if they were to swim <span class="math inline">\(2\)</span> weeks from the last recorded time.</li>
</ol>
</blockquote>
<ul>
<li>Suppose a linear model <span class="math display">\[Y = X\beta + \epsilon\]</span></li>
</ul>
<p><span class="math display">\[Y_i = x_{i,1} \beta_1 + x_{i,2} \beta_2 + \epsilon_i\]</span></p>
<ul>
<li><p><span class="math inline">\(Y = \begin{bmatrix} Y_1\\ \vdots\\ Y_6\end{bmatrix}\)</span>. A swimmer’s record of <span class="math inline">\(6\)</span>. Series in time</p></li>
<li><p><span class="math inline">\(X = \begin{bmatrix} x_{1,1} &amp; x_{1,2}\\ \vdots &amp; \vdots \\ x_{6,1} &amp; x_{6,2} \end{bmatrix}\)</span></p>
<ul>
<li><span class="math inline">\(x_{j,1}\)</span>: <span class="math inline">\(j\)</span>th record with swim score in the range of 22 to 24 second</li>
<li><span class="math inline">\(x_{j,2}\)</span>: Weeks of training</li>
</ul></li>
<li><p><span class="math inline">\(\beta = \begin{bmatrix} \beta_1 \\ \beta_2 \end{bmatrix}\)</span>.</p>
<ul>
<li><span class="math inline">\(\mu_0 = \begin{bmatrix} 23\\ 0 \end{bmatrix}\)</span>
<ul>
<li>The prior expectation of intercept of <span class="math inline">\(y\)</span> is <span class="math inline">\(23\)</span>.</li>
</ul></li>
<li><span class="math inline">\(\beta_0 \sim N_p(\mu_0, \Sigma_0)\)</span>.
<ol type="1">
<li>FCD: <span class="math inline">\(\beta|y, \sigma^2 \sim N_p(\beta_n, \Sigma_n)\)</span></li>
<li><span class="math inline">\(\Sigma^{-1}_{n} = \Sigma^{-1}_{0} + \frac{X^T X}{\sigma^2}\)</span></li>
<li><span class="math inline">\(\beta_n = \Sigma_n (\Sigma^{-1}_{0} \beta_0 + \frac{X^T y}{\sigma^2})\)</span></li>
</ol></li>
</ul></li>
</ul>
<p><strong>Prior setting</strong></p>
<ul>
<li><span class="math inline">\(\Sigma_{0} = \begin{bmatrix} 0.1 &amp; 0\\ 0 &amp; 0.1 \end{bmatrix}\)</span>
<ul>
<li>There is uncertainty about <span class="math inline">\(\beta\)</span> estimation.</li>
<li>Covariance of time and intersept is believe as <span class="math inline">\(0\)</span></li>
</ul></li>
<li><span class="math inline">\(\sigma^2 \sim IG(\nu_0/2 , \nu_0 \sigma^{2}_0 /2)\)</span>
<ul>
<li>FCD: <span class="math inline">\(\sigma^2 |y,\beta \sim IG((\nu_0 + n)/2, (\nu_0\sigma^{2}_{0}) + SSR(\beta)/2)\)</span></li>
</ul></li>
<li><span class="math inline">\(SSR(\beta) = (y - X\beta)^T (y-X\beta)\)</span></li>
</ul>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ys <span class="op">=</span> <span class="fu">readdlm</span>(<span class="st">"data/swim.dat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>4×6 Matrix{Float64}:
 23.1  23.2  22.9  22.9  22.8  22.7
 23.2  23.1  23.4  23.5  23.5  23.4
 22.7  22.6  22.8  22.8  22.9  22.8
 23.7  23.6  23.7  23.5  23.5  23.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">Problem 9.1 (a)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="pp">@proto</span> <span class="kw">struct</span> SwimmingModel </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="fl">1000</span> <span class="co"># Number of sampling</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    y </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fu">length</span>(y) <span class="co"># number of records</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> <span class="fu">hcat</span>( <span class="fu">ones</span>(n), <span class="fu">collect</span>(<span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span>) )</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">size</span>(X)[<span class="fl">2</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    β₀ <span class="op">=</span> <span class="fu">MvNormal</span>([<span class="fl">23</span>., <span class="fl">0</span>.], [<span class="fl">0.1</span> <span class="fl">0</span>; <span class="fl">0</span> <span class="fl">0.1</span>])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    ν₀ <span class="op">=</span> <span class="fl">1</span>.</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    σ₀² <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">SSR</span>(β, y, X)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    ssrV <span class="op">=</span> (y <span class="op">-</span> X<span class="op">*</span>β)<span class="ch">' * (y - X*β)</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">sum</span>(ssrV)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">β_FCD</span>(σ², m<span class="op">::</span><span class="dt">SwimmingModel</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    Σₙ <span class="op">=</span>( m.β₀.Σ<span class="op">^-</span><span class="fl">1</span> <span class="op">+</span> m.X<span class="op">'</span> <span class="op">*</span> m.X <span class="op">/</span> σ²)<span class="op">^-</span><span class="fl">1</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    μₙ <span class="op">=</span> <span class="fu">Σₙ*</span>(m.β₀.Σ<span class="op">^-</span><span class="fl">1</span> <span class="op">*</span> m.β₀.μ <span class="op">+</span> m.X<span class="op">'</span> <span class="op">*</span> m.y <span class="op">/</span> σ²)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MvNormal</span>(<span class="fu">vec</span>(μₙ), <span class="fu">Hermitian</span>(Σₙ))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">σ²_FCD</span>(β, m<span class="op">::</span><span class="dt">SwimmingModel</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    α <span class="op">=</span> (m.ν₀ <span class="op">+</span> m.n)<span class="op">/</span><span class="fl">2</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    θ <span class="op">=</span> (m.ν₀<span class="op">*</span>m.σ₀²) <span class="op">+</span> <span class="fu">SSR</span>(β, m.y, m.X)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">InverseGamma</span>(α, θ)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">pred</span>(X, m<span class="op">::</span><span class="dt">SwimmingModel</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling vector</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    βsmp <span class="op">=</span> <span class="fu">zeros</span>(m.S, <span class="fu">length</span>(m.β₀.μ))</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    σ²smp <span class="op">=</span> <span class="fu">zeros</span>(m.S)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="fu">zeros</span>(m.S)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Init</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    βsmp[<span class="fl">1</span>,<span class="op">:</span>] <span class="op">=</span> <span class="fu">rand</span>(m.β₀)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    σ²smp[<span class="fl">1</span>] <span class="op">=</span> m.σ₀²</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    y[<span class="fl">1</span>] <span class="op">=</span> m.y[<span class="fl">1</span>]</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>m.S </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        βsmp[i,<span class="op">:</span>] <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">β_FCD</span>(σ²smp[i<span class="op">-</span><span class="fl">1</span>], m))</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        σ²smp[i] <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">σ²_FCD</span>(βsmp[i<span class="op">-</span><span class="fl">1</span>,<span class="op">:</span>], m))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict </span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="op">=</span> βsmp[i,<span class="op">:</span>]<span class="ch">' * X + rand(Normal(0., σ²smp[i]))</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (y<span class="op">=</span>y, β<span class="op">=</span>βsmp, σ²<span class="op">=</span>σ²smp)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>j_swim <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>ms <span class="op">=</span> [ <span class="fu">SwimmingModel</span>(y <span class="op">=</span> <span class="fu">hcat</span>(ys[i,<span class="op">:</span>]), S<span class="op">=</span><span class="fl">10000</span> ) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">size</span>(ys)[<span class="fl">1</span>] ]</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>ys_pred <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">size</span>(ys)[<span class="fl">1</span>], ms[<span class="fl">1</span>].S) </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>X_pred <span class="op">=</span> [<span class="fl">1</span>,<span class="fl">12</span>]</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(ms)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    ys_pred[i,<span class="op">:</span>] <span class="op">=</span> <span class="fu">pred</span>([<span class="fl">1</span>,<span class="fl">12</span>], ms[i]).y</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co">## Plotting</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> [<span class="fu">histogram</span>(ys_pred[i,<span class="op">:</span>], label<span class="op">=</span><span class="st">"Swimmer </span><span class="sc">$</span>i<span class="st">"</span>, color<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">"Week"</span>, ylabel<span class="op">=</span><span class="st">"Seconds"</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    ) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">size</span>(ys)[<span class="fl">1</span>]]</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p<span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<p><img src="hw9_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="b" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2" class="anchored" data-anchor-id="b"><span class="header-section-number">13.3.2</span> (b)</h3>
<blockquote class="blockquote">
<p>The coach of the team has to decide which of the four swimmers will compete in a swimming meet in <span class="math inline">\(2\)</span> weeks. Using your predictive distributions, compute <span class="math inline">\(Pr(Y^{*}_{j} = \max\{Y^{*}_1,\dots, Y^{*}_4\}|Y)\)</span> for each swimmer <span class="math inline">\(j\)</span>, and based on this make a recommendation to the coach.</p>
</blockquote>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>am <span class="op">=</span> <span class="fu">argmax</span>(ys_pred, dims<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>y_count <span class="op">=</span> <span class="fu">zeros</span>(<span class="fl">1</span>, <span class="fu">size</span>(ys)[<span class="fl">1</span>])</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> am </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    y_count[a[<span class="fl">1</span>]] <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>pmax <span class="op">=</span> <span class="fu">vec</span>(y_count <span class="op">./</span> <span class="fu">length</span>(am))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Recommendation</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> <span class="fu">DataFrame</span>( <span class="fu">Dict</span>(<span class="st">"Swimmer"</span><span class="op">=&gt;</span> <span class="fu">collect</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">size</span>(ys)[<span class="fl">1</span>]),<span class="st">"Pr(Y_i is max)"</span> <span class="op">=&gt;</span> pmax ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div><div style="float: left;"><span>4×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;"><table class="data-frame table table-sm table-striped" style="margin-bottom: 6px;"><thead><tr class="header"><th class="rowNumber" style="font-weight: bold; text-align: right;">Row</th><th style="text-align: left;">Pr(Y_i is max)</th><th style="text-align: left;">Swimmer</th></tr><tr class="subheader headerLastRow"><th class="rowNumber" style="font-weight: bold; text-align: right;"></th><th title="Float64" style="text-align: left;">Float64</th><th title="Int64" style="text-align: left;">Int64</th></tr></thead><tbody><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">1</td><td style="text-align: right;">0.023</td><td style="text-align: right;">1</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">2</td><td style="text-align: right;">0.4773</td><td style="text-align: right;">2</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">3</td><td style="text-align: right;">0.0424</td><td style="text-align: right;">3</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">4</td><td style="text-align: right;">0.4573</td><td style="text-align: right;">4</td></tr></tbody></table></div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="cell-output cell-output-stdout">
<pre><code>Swimmer 2 is the most probable winner.</code></pre>
</div>
</div>
</section>
</section>
<section id="problem-9.2" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="problem-9.2"><span class="header-section-number">13.4</span> Problem 9.2</h2>
<blockquote class="blockquote">
<p>Model selection: As described in Example 6 of Chapter 7, the file <code>azdiabetes.dat</code> contains data on health-related variables of a population of <span class="math inline">\(532\)</span> women. In this exercise we will be modeling the conditional distribution of glucose level (<code>glu</code>) as a linear combination of the other variables, excluding the variable <code>diabetes</code>.</p>
</blockquote>
<section id="a-1" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="a-1"><span class="header-section-number">13.4.1</span> (a)</h3>
<blockquote class="blockquote">
<p>Fit a regression model using the <span class="math inline">\(g\)</span>-prior with <span class="math inline">\(g=n\)</span>, <span class="math inline">\(\nu_0 =2\)</span> and <span class="math inline">\(\sigma^{2}_{0} = 1\)</span>. Obtain posterior confidence intervals for all of the parameters.</p>
</blockquote>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="fu">readdlm</span>(<span class="st">"data/azdiabetes.dat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>533×8 Matrix{Any}:
   "npreg"     "glu"    "bp"    "skin"    "bmi"   "ped"    "age"  "diabetes"
  5          86       68      28        30.2     0.364   24       "No"
  7         195       70      33        25.1     0.163   55       "Yes"
  5          77       82      41        35.8     0.156   35       "No"
  0         165       76      43        47.9     0.259   26       "No"
  0         107       60      25        26.4     0.133   23       "No"
  5          97       76      27        35.6     0.378   52       "Yes"
  3          83       58      31        34.3     0.336   25       "No"
  1         193       50      16        25.9     0.655   24       "No"
  3         142       80      15        32.4     0.2     63       "No"
  2         128       78      37        43.3     1.224   31       "Yes"
  0         137       40      35        43.1     2.288   33       "Yes"
  9         154       78      30        30.9     0.164   45       "No"
  ⋮                                              ⋮                
 12         100       84      33        30.0     0.488   46       "No"
  1         147       94      41        49.3     0.358   27       "Yes"
  3         187       70      22        36.4     0.408   36       "Yes"
  1         121       78      39        39.0     0.261   28       "No"
  3         108       62      24        26.0     0.223   25       "No"
  0         181       88      44        43.3     0.222   26       "Yes"
  1         128       88      39        36.5     1.057   37       "Yes"
  2          88       58      26        28.4     0.766   22       "No"
  9         170       74      31        44.0     0.403   43       "Yes"
 10         101       76      48        32.9     0.171   63       "No"
  5         121       72      23        26.2     0.245   30       "No"
  1          93       70      31        30.4     0.315   23       "No"</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> data[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> , <span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="fu">float</span>.(dt[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>, <span class="fl">2</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">float</span>.(dt[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>, <span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">.!=</span> <span class="fl">2</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ns <span class="op">=</span> data[<span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ns <span class="op">=</span> ns[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span> <span class="op">.!=</span><span class="fl">2</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@proto</span> <span class="kw">struct</span> DiabetesModel </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="fl">500</span> <span class="co"># Number of sampling</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    y </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    X</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fu">length</span>(y) <span class="co"># number of records</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">size</span>(X)[<span class="fl">2</span>]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> n <span class="co"># g prior</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    ν₀ <span class="op">=</span> <span class="fl">2</span>.</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    σ₀² <span class="op">=</span> <span class="fl">1</span>.</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">β_FCD</span>(σ², m<span class="op">::</span><span class="dt">DiabetesModel</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">β_FCD</span>(σ², m.g, m.X, m.y)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">β_FCD</span>(σ², g, X, y)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    Σₙ <span class="op">=</span> g<span class="op">/</span>(g<span class="op">+</span><span class="fl">1</span>) <span class="op">*</span> σ² <span class="op">*</span> (X<span class="op">'</span>X)<span class="op">^-</span><span class="fl">1</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    μₙ <span class="op">=</span> g<span class="op">/</span>(g<span class="op">+</span><span class="fl">1</span>) <span class="op">*</span> <span class="fu">β̂</span>(σ², y, X)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    βₙ <span class="op">=</span>  <span class="fu">MvNormal</span>(μₙ, <span class="fu">Hermitian</span>(Σₙ))</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> βₙ    </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">β̂</span>(σ², y, X)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> σ² <span class="op">*</span> (X<span class="op">'</span>X)<span class="op">^-</span><span class="fl">1</span> <span class="op">*</span> (X<span class="op">'</span>y <span class="op">/</span> σ²)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">σ²_FCD</span>(m<span class="op">::</span><span class="dt">DiabetesModel</span>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">σ²_FCD</span>(m.ν₀, m.σ₀², m.n, m.X, m.y, m.g)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">σ²_FCD</span>(ν₀, σ₀², n, X, y, g)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    α <span class="op">=</span> ν₀ <span class="op">+</span> n <span class="op">/</span> <span class="fl">2</span>.</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    θ <span class="op">=</span> (ν₀ <span class="op">*</span> σ₀² <span class="op">+</span> <span class="fu">SSR</span>(X, y, g))<span class="op">/</span><span class="fl">2</span>.</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">=</span> <span class="fu">InverseGamma</span>(α, θ)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> σ²</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">SSR</span>(m<span class="op">::</span><span class="dt">DiabetesModel</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">SSR</span>(m.X, m.y, m.g)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">SSR</span>(X, y, g)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y<span class="op">'</span><span class="fu">*</span>(I <span class="op">-</span> g<span class="op">/</span>(g<span class="op">+</span><span class="fl">1</span>)<span class="fu">*X*</span>(X<span class="op">'</span>X)<span class="op">^-</span><span class="fl">1</span><span class="op">*</span>X<span class="op">'</span>)<span class="op">*</span>y</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="fu">DiabetesModel</span>(y<span class="op">=</span>y, X<span class="op">=</span>X )</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>σ²smp <span class="op">=</span> <span class="fu">zeros</span>(m.S, <span class="fl">1</span>)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>βsmp <span class="op">=</span> <span class="fu">zeros</span>(m.S, <span class="fu">size</span>(m.X)[<span class="fl">2</span>])</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> m.S</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    σ²smp[i] <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">σ²_FCD</span>(m))</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    βsmp[i,<span class="op">:</span>] <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">β_FCD</span>(σ²smp[i], m))</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> [<span class="fu">histogram</span>(βsmp[<span class="op">:</span>,i], xlabel<span class="op">=</span><span class="st">"Quantity"</span>, </span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>      ylabel<span class="op">=</span><span class="st">"Probability"</span>,normalize<span class="op">=</span><span class="cn">true</span>, label<span class="op">=</span><span class="st">"</span><span class="sc">$</span>(ns[i])<span class="st">"</span>, color<span class="op">=</span><span class="st">"black"</span>) </span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>      for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>m.p]</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ps<span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<p><img src="hw9_files/figure-html/cell-8-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="b-1" class="level3" data-number="13.4.2">
<h3 data-number="13.4.2" class="anchored" data-anchor-id="b-1"><span class="header-section-number">13.4.2</span> (b)</h3>
<blockquote class="blockquote">
<p>Perform the model selection and averaging procedure described in Section 9.3. Obtain <span class="math inline">\(Pr(\beta_j \neq 0 |y)\)</span>, as well as posterior confidence intervals for all of the parameters. Compare to the results in part (a).</p>
</blockquote>
<p><span class="math display">\[\{y|X_{z(k)},\beta_{z(k)}, \sigma^2\} \sim \text{ multivariate normal }(X_{z(k)}\beta_{z(k)}, \sigma^2 I)\]</span></p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="fu">DiabetesModel</span>(y<span class="op">=</span>y, X<span class="op">=</span>X,  S<span class="op">=</span><span class="fl">1000</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">σ²_FCD</span>(m<span class="op">::</span><span class="dt">DiabetesModel</span>, zs)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    Xz <span class="op">=</span> <span class="pp">@view</span> m.X[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>, <span class="fu">Bool</span>.(zs)]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">σ²_FCD</span>(m.ν₀, m.σ₀², m.n, Xz, m.y, m.g)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">β_FCD</span>(σ², m<span class="op">::</span><span class="dt">DiabetesModel</span>, zs)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    Xz  <span class="op">=</span> <span class="pp">@view</span> m.X[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>, <span class="fu">Bool</span>.(zs)]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">β_FCD</span>(σ², m.g, Xz, m.y)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">y_margin</span>(σz², m<span class="op">::</span><span class="dt">DiabetesModel</span>, zs)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    ν₀ <span class="op">=</span> m.ν₀</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> m.n</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> m.y </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> m.g</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    pz <span class="op">=</span> <span class="fu">sum</span>(zs)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    Xz  <span class="op">=</span> <span class="pp">@view</span> m.X[<span class="fl">1</span><span class="op">:</span><span class="kw">end</span>, <span class="fu">Bool</span>.(zs)]</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    ssr <span class="op">=</span> <span class="fu">SSR</span>(Xz, y, g)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    pyl <span class="op">=</span> <span class="fu">-</span>(pz<span class="op">/</span><span class="fl">2</span>.)<span class="fu">log</span>(<span class="fl">1</span>. <span class="op">+</span>g) <span class="op">+</span> (ν₀<span class="op">/</span><span class="fl">2</span>.)<span class="fu">*log</span>(σz²) <span class="op">-</span> ((ν₀<span class="op">+</span>n)<span class="op">/</span><span class="fl">2</span>)<span class="fu">*log</span>((ν₀<span class="op">*</span>σz² <span class="op">+</span> ssr))</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pyl</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">z_FCD</span>(i , σz², zsmp, nSmp,m<span class="op">::</span><span class="dt">DiabetesModel</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    zs <span class="op">=</span> zsmp[nSmp,<span class="op">:</span>]</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    pj1 <span class="op">=</span> <span class="fu">sum</span>(zsmp[<span class="fl">1</span><span class="op">:</span>nSmp, i]) <span class="op">/</span> <span class="fu">length</span>(zsmp[<span class="fl">1</span><span class="op">:</span>nSmp, i])</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    pj0 <span class="op">=</span> <span class="fl">1</span>. <span class="op">-</span> pj1</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    pj1_FCD_l <span class="op">=</span>  pj1 <span class="op">*</span> <span class="fu">y_margin</span>(σz², m, <span class="fu">ones</span>(<span class="fu">length</span>(zs)))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    pj0_FCD_l <span class="op">=</span>  pj0 <span class="op">*</span> <span class="fu">y_margin</span>(σz², m, zs)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    O <span class="op">=</span> <span class="fu">exp</span>(pj0_FCD_l <span class="op">-</span> pj1_FCD_l)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">Bernoulli</span>( <span class="fl">1</span><span class="op">/</span>(<span class="fl">1</span><span class="op">+</span>O))</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>zsmp <span class="op">=</span> <span class="fu">ones</span>(m.S, <span class="fu">size</span>(m.X)[<span class="fl">2</span>])</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>σ²smp <span class="op">=</span> <span class="fu">zeros</span>(m.S, <span class="fl">1</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>βsmp <span class="op">=</span> <span class="fu">zeros</span>(m.S, <span class="fu">size</span>(m.X)[<span class="fl">2</span>])</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>σ²smp[<span class="fl">1</span>] <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Gibbs sampling</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>m.S</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">Random</span>.<span class="fu">shuffle</span>(<span class="fl">1</span><span class="op">:</span>m.p)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>        zp <span class="op">=</span> <span class="fu">z_FCD</span>(j, σ²smp[i<span class="op">-</span><span class="fl">1</span>], zsmp, i<span class="op">-</span><span class="fl">1</span>, m)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        zsmp[i, j] <span class="op">=</span> <span class="fu">rand</span>(zp)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    σ²smp[i] <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">σ²_FCD</span>(m, zsmp[i,<span class="op">:</span>]))</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    βsmp[i, <span class="fu">Bool</span>.(zsmp[i,<span class="op">:</span>])] <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">β_FCD</span>(σ²smp[i], m, zsmp[i,<span class="op">:</span>]))</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(zsmp, dims<span class="op">=</span><span class="fl">1</span>)<span class="op">/</span><span class="fu">size</span>(zsmp)[<span class="fl">1</span>]</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>prB <span class="op">=</span> <span class="fl">1</span>. <span class="op">.-</span> <span class="fu">vec</span>(<span class="fu">sum</span>(zsmp, dims<span class="op">=</span><span class="fl">1</span>))<span class="op">./</span><span class="fu">size</span>(zsmp)[<span class="fl">1</span>]</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="fu">DataFrame</span>(<span class="fu">Dict</span>( <span class="st">"Bi"</span><span class="op">=&gt;</span> ns, <span class="st">"Pr(Bi != 0 |y)"</span><span class="op">=&gt;</span> prB ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div><div style="float: left;"><span>6×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;"><table class="data-frame table table-sm table-striped" style="margin-bottom: 6px;"><thead><tr class="header"><th class="rowNumber" style="font-weight: bold; text-align: right;">Row</th><th style="text-align: left;">Bi</th><th style="text-align: left;">Pr(Bi != 0 |y)</th></tr><tr class="subheader headerLastRow"><th class="rowNumber" style="font-weight: bold; text-align: right;"></th><th title="Any" style="text-align: left;">Any</th><th title="Float64" style="text-align: left;">Float64</th></tr></thead><tbody><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">1</td><td style="text-align: left;">npreg</td><td style="text-align: right;">0.499</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">2</td><td style="text-align: left;">bp</td><td style="text-align: right;">0.499</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">3</td><td style="text-align: left;">skin</td><td style="text-align: right;">0.499</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">4</td><td style="text-align: left;">bmi</td><td style="text-align: right;">0.499</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">5</td><td style="text-align: left;">ped</td><td style="text-align: right;">0.499</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">6</td><td style="text-align: left;">age</td><td style="text-align: right;">0.5</td></tr></tbody></table></div>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>inds <span class="op">=</span> prB <span class="op">.&gt;=</span> <span class="fl">0.5</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>b_select <span class="op">=</span> prB[inds]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> [<span class="fu">histogram</span>(βsmp[<span class="op">:</span>, i], xlabel<span class="op">=</span><span class="st">"Quantity"</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      ylabel<span class="op">=</span><span class="st">"Probability"</span>,normalize<span class="op">=</span><span class="cn">true</span>, label<span class="op">=</span><span class="st">"</span><span class="sc">$</span>(ns[i])<span class="st">"</span>, color<span class="op">=</span><span class="st">"black"</span>) </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      for i <span class="kw">in</span>  <span class="fu">findall</span>(inds <span class="op">.==</span> <span class="fl">1</span>)]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ps<span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<p><img src="hw9_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DataFrame</span>(<span class="fu">Dict</span>(<span class="st">"Parameters"</span><span class="op">=&gt;</span> ns[inds], </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Confidence interval"</span><span class="op">=&gt;</span> [<span class="fu">quantile</span>(βsmp[<span class="op">:</span>,i], [<span class="fl">0.25</span>, <span class="fl">0.975</span>]) for i <span class="kw">in</span>  <span class="fu">findall</span>(inds <span class="op">.==</span> <span class="fl">1</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div><div style="float: left;"><span>1×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;"><table class="data-frame table table-sm table-striped" style="margin-bottom: 6px;"><thead><tr class="header"><th class="rowNumber" style="font-weight: bold; text-align: right;">Row</th><th style="text-align: left;">Confidence interval</th><th style="text-align: left;">Parameters</th></tr><tr class="subheader headerLastRow"><th class="rowNumber" style="font-weight: bold; text-align: right;"></th><th title="Vector{Float64}" style="text-align: left;">Array…</th><th title="Any" style="text-align: left;">Any</th></tr></thead><tbody><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">1</td><td style="text-align: left;">[0.0, 1.1847]</td><td style="text-align: left;">age</td></tr></tbody></table></div>
</div>
</div>
<p><strong>Conclusion</strong></p>
<p>There might be some bugs in FCD formulation. The current results show that all the features are equally important after model selection. The distribution is far different from what it is in part (a).</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../hw/hw8.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Homework 8</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../hw/hw10.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Homework 10</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Homework 9"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Shao-Ting Chiu (UIN:433002162)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    url: stchiu@email.tamu.edu</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Department of Electrical and Computer Engineering, Texas A\&amp;M University</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../ref.bib</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">    table-of-contents: true</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    keep-ipynb: true</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">    table-of-contents: true</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">    tex-engine: lualatex</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> julia-1.8</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">    echo: true</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">    freeze: auto</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Computational Environment</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="in">``` {julia}</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>using Pkg</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>Pkg.activate(<span class="ot">"</span><span class="st">hw9</span><span class="ot">"</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>using Distributions</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>using DataFrames</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>using Plots</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>using DelimitedFiles</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>using LinearAlgebra</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>using Statistics</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>using ProtoStructs</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>using CSV</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="fu">import</span> Random</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>Random.seed!(<span class="dv">2022</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="st">## Description</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="st">- Course: STAT638, 2022 Fall</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="st">- Deadline: 2022/11/17, 12:00 pm</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; Read Chapter 9 in the Hoff book. Then do Problems 9.1 and 9.2 in Hoff.</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; </span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; For both regression models, please include an intercept term (</span><span class="wa">$\</span><span class="st">beta_0</span><span class="wa">$)</span><span class="st">.</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; </span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; In 9.1(b), please replace "max" by "min". (This is not listed in the official book errata, but appears to be a typo.)</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; </span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; For 9.2, the azdiabetes.dat data are described in *Exercise* 6 of Chapter 7 (see errata).</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="st">- Note: This PDF file is generated by Quarto and LualaTeX. There is unsolved problem to display the special character in the source code. Thus, I leave the html version here for reference that displays the complete source code: </span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; [https://stchiu.quarto.pub/stat_638_hw_9/](https://stchiu.quarto.pub/stat_638_hw_9/)</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="st">## Problem 9.1</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; Extrapolation: The file </span><span class="ot">`</span>swim.dat<span class="ot">`</span><span class="st"> contains data on the amount of time in seconds, it takes each of four high school swimmers to swim </span><span class="wa">$50</span><span class="st">$ yards. Each swimmer has </span><span class="wa">$6</span><span class="st">$ times, taken on a biweekly basis.</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="st">### (a)</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; Perform the following data analysis for each swimmer separately:</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; </span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; 1. Fit a linear regression model of swimming time as the response and week as the explanatory variable. To formulate your prior, use the information that competitive times for this age group generally range from </span><span class="wa">$22</span><span class="st">$ to </span><span class="wa">$24</span><span class="st">$ seconds.</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; 2. For each swimmer </span><span class="dt">$j</span><span class="wa">$,</span><span class="st"> obtain a posterior predictive distribution for </span><span class="dt">$Y</span><span class="st">^{*}_j</span><span class="wa">$,</span><span class="st"> their time if they were to swim </span><span class="wa">$2</span><span class="st">$ weeks from the last recorded time.</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="st">- Suppose a linear model</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="dt">$$Y</span><span class="st"> = X</span><span class="ch">\b</span><span class="st">eta + </span><span class="ch">\e</span><span class="st">psilon</span><span class="wa">$$</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a><span class="dt">$$Y_i</span><span class="st"> = x_{i,1} </span><span class="ch">\b</span><span class="st">eta_1 + x_{i,2} </span><span class="ch">\b</span><span class="st">eta_2 + </span><span class="ch">\e</span><span class="st">psilon_i</span><span class="wa">$$</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="st">- </span><span class="dt">$Y</span><span class="st"> = </span><span class="ch">\b</span><span class="st">egin{bmatrix} Y_1\\  </span><span class="ch">\v</span><span class="st">dots\\ Y_6</span><span class="ch">\e</span><span class="st">nd{bmatrix}</span><span class="wa">$.</span><span class="st"> A swimmer's record of </span><span class="wa">$6$.</span><span class="st"> Series in time</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="st">- </span><span class="dt">$X</span><span class="st"> = </span><span class="ch">\b</span><span class="st">egin{bmatrix} x_{1,1} &amp; x_{1,2}\\ </span><span class="ch">\v</span><span class="st">dots &amp; </span><span class="ch">\v</span><span class="st">dots \\ x_{6,1} &amp; x_{6,2} </span><span class="ch">\e</span><span class="st">nd{bmatrix}$</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a><span class="st">  - </span><span class="dt">$x_</span><span class="st">{j,1}</span><span class="wa">$:</span><span class="st"> </span><span class="dt">$j$th</span><span class="st"> record with swim score in the range of 22 to 24 second</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a><span class="st">  - </span><span class="dt">$x_</span><span class="st">{j,2}</span><span class="wa">$:</span><span class="st"> Weeks of training</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="st">- </span><span class="wa">$\</span><span class="st">beta = </span><span class="ch">\b</span><span class="st">egin{bmatrix} </span><span class="ch">\b</span><span class="st">eta_1 \\ </span><span class="ch">\b</span><span class="st">eta_2 </span><span class="ch">\e</span><span class="st">nd{bmatrix}</span><span class="wa">$.</span><span class="st"> </span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="st">  - </span><span class="wa">$\</span><span class="st">mu_0 = </span><span class="ch">\b</span><span class="st">egin{bmatrix} 23\\ 0 </span><span class="ch">\e</span><span class="st">nd{bmatrix}$</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a><span class="st">    - The prior expectation of intercept of </span><span class="dt">$y</span><span class="st">$ is </span><span class="wa">$23$.</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a><span class="st">  - </span><span class="wa">$\</span><span class="st">beta_0 </span><span class="ch">\s</span><span class="st">im N_p(\mu_0, </span><span class="ch">\S</span><span class="st">igma_0)</span><span class="wa">$.</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="st">    1. FCD: </span><span class="wa">$\</span><span class="st">beta|y, </span><span class="ch">\s</span><span class="st">igma^2 </span><span class="ch">\s</span><span class="st">im N_p(</span><span class="ch">\b</span><span class="st">eta_n, </span><span class="ch">\S</span><span class="st">igma_n)$</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="st">    1. </span><span class="wa">$\S</span><span class="st">igma^{-1}_{n} = </span><span class="ch">\S</span><span class="st">igma^{-1}_{0} + </span><span class="ch">\f</span><span class="st">rac{X^T X}{</span><span class="ch">\s</span><span class="st">igma^2}$</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="st">    2. </span><span class="wa">$\</span><span class="st">beta_n = </span><span class="ch">\S</span><span class="st">igma_n (</span><span class="ch">\S</span><span class="st">igma^{-1}_{0} </span><span class="ch">\b</span><span class="st">eta_0 + </span><span class="ch">\f</span><span class="st">rac{X^T y}{</span><span class="ch">\s</span><span class="st">igma^2})$ </span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a><span class="st">**Prior setting**</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="st">- </span><span class="wa">$\S</span><span class="st">igma_{0} = </span><span class="ch">\b</span><span class="st">egin{bmatrix} 0.1 &amp; 0\\ 0 &amp; 0.1 </span><span class="ch">\e</span><span class="st">nd{bmatrix}$</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="st">  - There is uncertainty about </span><span class="wa">$\</span><span class="st">beta$ estimation. </span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a><span class="st">  - Covariance of time and intersept is believe as </span><span class="wa">$0</span><span class="st">$</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="st">- </span><span class="wa">$\</span><span class="st">sigma^2 </span><span class="ch">\s</span><span class="st">im IG(</span><span class="ch">\n</span><span class="st">u_0/2 , </span><span class="ch">\n</span><span class="st">u_0 </span><span class="ch">\s</span><span class="st">igma^{2}_0 /2)$</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a><span class="st">  - FCD: </span><span class="wa">$\</span><span class="st">sigma^2 |y,</span><span class="ch">\b</span><span class="st">eta </span><span class="ch">\s</span><span class="st">im IG((</span><span class="ch">\n</span><span class="st">u_0 + n)/2, (</span><span class="ch">\n</span><span class="st">u_0</span><span class="ch">\s</span><span class="st">igma^{2}_{0}) + SSR(</span><span class="ch">\b</span><span class="st">eta)/2)$</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a><span class="st">- </span><span class="dt">$SSR</span><span class="st">(</span><span class="ch">\b</span><span class="st">eta) = (y - X</span><span class="ch">\b</span><span class="st">eta)^T (y-X</span><span class="ch">\b</span><span class="st">eta)$</span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span> {julia}</span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>ys = readdlm(<span class="ot">"</span><span class="st">data/swim.dat</span><span class="ot">"</span>)</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span> {julia}</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a><span class="ot">"""</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="st">Problem 9.1 (a)</span></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="ot">"""</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a><span class="dt">@proto</span> struct SwimmingModel </span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>    S = <span class="dv">1000</span> <span class="co"># Number of sampling</span></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data</span></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>    y </span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>    n = <span class="fu">length</span>(y) <span class="co"># number of records</span></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model</span></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>    X = hcat( ones(n), collect(<span class="dv">0</span>:<span class="dv">2</span>:<span class="dv">10</span>) )</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>    p = size(X)[<span class="dv">2</span>]</span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    β₀ = MvNormal([<span class="dv">23</span>., <span class="dv">0</span>.], [<span class="fl">0.1</span> <span class="dv">0</span>; <span class="dv">0</span> <span class="fl">0.1</span>])</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>    ν₀ = <span class="dv">1</span>.</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>    σ₀² = <span class="fl">0.2</span></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>function SSR(β, <span class="ot">y</span>, X)</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>    ssrV = (<span class="ot">y </span>- X<span class="wa">*β</span>)<span class="ot">'</span><span class="ss"> * (y - X*β)</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a><span class="ss">    return sum(ssrV)</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a><span class="ss">end</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="ss">function β_FCD(σ², m::SwimmingModel)</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a><span class="ss">    Σₙ =( m.β₀.Σ^-1 + m.X</span><span class="ot">'</span> <span class="ot">*</span> <span class="ot">m.X / σ²</span><span class="ch">)^</span><span class="ot">-1</span></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a><span class="ot">    μₙ = Σₙ</span><span class="ch">*(</span><span class="ot">m.</span>β₀.Σ^-<span class="dv">1</span> <span class="ot">*</span> <span class="ot">m.β₀.</span>μ + <span class="ot">m.X' </span><span class="ch">*</span><span class="ot"> m.y / σ²</span><span class="ch">)</span></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a><span class="ot">    return MvNormal</span><span class="ch">(</span><span class="ot">vec</span><span class="ch">(</span><span class="ot">μₙ</span><span class="ch">)</span><span class="ot">, Hermitian</span><span class="ch">(</span><span class="ot">Σₙ</span><span class="ch">))</span></span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a><span class="ot">function σ²_FCD</span><span class="ch">(</span><span class="ot">β, m::SwimmingModel</span><span class="ch">)</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a><span class="ot">    α = </span><span class="ch">(</span><span class="ot">m.ν₀ </span><span class="ch">+</span><span class="ot"> m.n</span><span class="ch">)</span><span class="ot">/</span><span class="dv">2</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>    θ = (<span class="ot">m.ν₀</span><span class="ch">*</span><span class="ot">m.</span>σ₀²) + SSR(β, <span class="ot">m.y, m.</span>X)</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> InverseGamma(α, θ)</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>function pred(X, <span class="fu">m::SwimmingModel</span>)</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling vector</span></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>    βsmp = zeros(<span class="ot">m.S, length</span><span class="ch">(</span><span class="ot">m.</span>β₀.μ))</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>    σ²smp = zeros(<span class="ot">m.S</span><span class="ch">)</span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a><span class="ot">    y = zeros</span><span class="ch">(</span><span class="ot">m.</span>S)</span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Init</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>    βsmp[<span class="dv">1</span>,:] = <span class="fu">rand</span>(<span class="ot">m.β₀</span><span class="ch">)</span></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a><span class="ot">    σ²smp</span><span class="ch">[</span><span class="bn">1</span><span class="ch">]</span><span class="ot"> = m.</span>σ₀²</span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>    <span class="ot">y</span>[<span class="dv">1</span>] = <span class="ot">m.y</span><span class="ch">[</span><span class="bn">1</span><span class="ch">]</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a><span class="ot">    for i in 2:m.</span>S </span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>        βsmp[i,:] = <span class="fu">rand</span>(β_FCD(σ²smp[i<span class="dv">-1</span>], m))</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>        σ²smp[i] = <span class="fu">rand</span>(σ²_FCD(βsmp[i<span class="dv">-1</span>,:], m))</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict </span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>        <span class="ot">y</span>[i] = βsmp[i,:]<span class="ot">'</span><span class="ss"> * X + rand(Normal(0., σ²smp[i]))</span></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a><span class="ss">    end</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a><span class="ss">    return (y=y, β=βsmp, σ²=σ²smp)</span></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a><span class="ss">end</span></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a><span class="ss">j_swim = 1</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a><span class="ss">ms = [ SwimmingModel(y = hcat(ys[i,:]), S=10000 ) for i in 1:size(ys)[1] ]</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a><span class="ss">ys_pred = zeros(size(ys)[1], ms[1].S) </span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a><span class="ss">X_pred = [1,12]</span></span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a><span class="ss">for i in eachindex(ms)</span></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a><span class="ss">    ys_pred[i,:] = pred([1,12], ms[i]).y</span></span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a><span class="ss">end</span></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a><span class="ss">## Plotting</span></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a><span class="ss">p = [histogram(ys_pred[i,:], label="Swimmer $i", color="black",</span></span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a><span class="ss">    xlabel="Week", ylabel="Seconds"</span></span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) for i in 1:size(ys)[1]]</span></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a><span class="ss">plot(p...)</span></span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a><span class="ss">### (b)</span></span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a><span class="ss">&gt; The coach of the team has to decide which of the four swimmers will compete in a swimming meet in $2$ weeks. Using your predictive distributions, compute $Pr(Y^{*}_{j} = \max\{Y^{*}_1,\dots, Y^{*}_4\}|Y)$ for each swimmer $j$, and based on this make a recommendation to the coach.</span></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a><span class="ss">``` {julia}</span></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a><span class="ss">am = argmax(ys_pred, dims=1)</span></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a><span class="ss">y_count = zeros(1, size(ys)[1])</span></span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a><span class="ss">for a in am </span></span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a><span class="ss">    y_count[a[1]] += 1</span></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a><span class="ss">end</span></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a><span class="ss">pmax = vec(y_count ./ length(am))</span></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a><span class="ss">## Recommendation</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a><span class="ss">ds = DataFrame( Dict("Swimmer"=&gt; collect(1:size(ys)[1]),"Pr(Y_i is max)" =&gt; pmax ))</span></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a><span class="ss">``` {julia}</span></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a><span class="ss">#| echo: false</span></span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a><span class="ss">print("Swimmer $(argmax(pmax)[1]) is the most probable winner.")</span></span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a><span class="ss">## Problem 9.2</span></span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a><span class="ss">&gt; Model selection: As described in Example 6 of Chapter 7, the file `azdiabetes.dat` contains data on health-related variables of a population of $532$ women. In this exercise we will be modeling the conditional distribution of glucose level (`glu`) as a linear combination of the other variables, excluding the variable `diabetes`.</span></span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a><span class="ss">### (a)</span></span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a><span class="ss">&gt; Fit a regression model using the $g$-prior with $g=n$, $\nu_0 =2$ and $\sigma^{2}_{0} = 1$. Obtain posterior confidence intervals for all of the parameters.</span></span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a><span class="ss">``` {julia}</span></span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a><span class="ss">data = readdlm("data/azdiabetes.dat")</span></span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a><span class="ss">``` {julia}</span></span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a><span class="ss">dt = data[1:end , 1:end-1]</span></span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a><span class="ss">y = float.(dt[2:end, 2])</span></span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a><span class="ss">X = float.(dt[2:end, 1:end .!= 2])</span></span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a><span class="ss">ns = data[1,1:end-1]</span></span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a><span class="ss">ns = ns[1:end .!=2]</span></span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a><span class="ss">@proto struct DiabetesModel </span></span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a><span class="ss">    S = 500 # Number of sampling</span></span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a><span class="ss">    # Data</span></span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a><span class="ss">    y </span></span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a><span class="ss">    X</span></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a><span class="ss">    n = length(y) # number of records</span></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a><span class="ss">    p = size(X)[2]</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a><span class="ss">    # Model </span></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a><span class="ss">    # Prior</span></span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a><span class="ss">    g = n # g prior</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a><span class="ss">    ν₀ = 2.</span></span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a><span class="ss">    σ₀² = 1.</span></span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a><span class="ss">end</span></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a><span class="ss">function β_FCD(σ², m::DiabetesModel)</span></span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a><span class="ss">    return β_FCD(σ², m.g, m.X, m.y)</span></span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a><span class="ss">end</span></span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a><span class="ss">function β_FCD(σ², g, X, y)</span></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a><span class="ss">    Σₙ = g/(g+1) * σ² * (X</span><span class="ot">'</span>X)^-<span class="dv">1</span></span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a>    μₙ = g/(g+<span class="dv">1</span>) <span class="ot">*</span> β̂(σ², <span class="ot">y</span>, X)</span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>    βₙ =  MvNormal(μₙ, Hermitian(Σₙ))</span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> βₙ    </span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>function β̂(σ², <span class="ot">y</span>, X)</span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> σ² <span class="ot">*</span> (X<span class="ot">'</span><span class="ss">X)^-1 * (X</span><span class="ot">'y / σ²</span><span class="ch">)</span></span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a><span class="ot">function σ²_FCD</span><span class="ch">(</span><span class="ot">m::DiabetesModel</span><span class="ch">)</span></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a><span class="ot">    return σ²_FCD</span><span class="ch">(</span><span class="ot">m.ν₀, m.σ₀², m.n, m.X, m.y, m.g</span><span class="ch">)</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a><span class="ot">function σ²_FCD</span><span class="ch">(</span><span class="ot">ν₀, σ₀², n, X, y, g</span><span class="ch">)</span></span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a><span class="ot">    α = ν₀ </span><span class="ch">+</span><span class="ot"> n /</span> <span class="dv">2</span>.</span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>    θ = (ν₀ <span class="ot">*</span> σ₀² + SSR(X, <span class="ot">y</span>, g))/<span class="dv">2</span>.</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a>    σ² = InverseGamma(α, θ)</span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> σ²</span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>function SSR(<span class="fu">m::DiabetesModel</span>)</span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> SSR(<span class="ot">m.X, m.y</span>, <span class="ot">m.g</span><span class="ch">)</span></span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a><span class="ot">function SSR</span><span class="ch">(</span><span class="ot">X, y, g</span><span class="ch">)</span></span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a><span class="ot">    return y'</span><span class="ch">*(</span><span class="ot">I - g/</span><span class="ch">(</span><span class="ot">g</span><span class="ch">+</span><span class="ot">1</span><span class="ch">)*</span><span class="ot">X</span><span class="ch">*(</span><span class="ot">X'X</span><span class="ch">)^</span><span class="ot">-1</span><span class="ch">*</span><span class="ot">X'</span><span class="ch">)*</span><span class="ot">y</span></span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a><span class="ot">m = DiabetesModel</span><span class="ch">(</span><span class="ot">y=y, X=X </span><span class="ch">)</span></span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a><span class="ot">σ²smp = zeros</span><span class="ch">(</span><span class="ot">m.</span>S, <span class="dv">1</span>)</span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>βsmp = zeros(<span class="ot">m.S, size</span><span class="ch">(</span><span class="ot">m.</span>X)[<span class="dv">2</span>])</span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i in <span class="dv">1</span>: <span class="ot">m.S</span></span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a><span class="ot">    σ²smp</span><span class="ch">[</span><span class="bn">i</span><span class="ch">]</span><span class="ot"> = rand</span><span class="ch">(</span><span class="ot">σ²_FCD</span><span class="ch">(</span><span class="ot">m</span><span class="ch">))</span></span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a><span class="ot">    βsmp</span><span class="ch">[</span><span class="bn">i,:</span><span class="ch">]</span><span class="ot"> = rand</span><span class="ch">(</span><span class="ot">β_FCD</span><span class="ch">(</span><span class="ot">σ²smp</span><span class="ch">[</span><span class="bn">i</span><span class="ch">]</span><span class="ot">, m</span><span class="ch">))</span></span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a><span class="ot">ps = </span><span class="ch">[</span><span class="bn">histogram(βsmp[:,i</span><span class="ch">]</span><span class="ot">, xlabel="Quantity", </span></span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a><span class="ot">      ylabel="Probability",normalize=true, label="</span><span class="ch">$(</span><span class="ot">ns</span><span class="ch">[</span><span class="bn">i</span><span class="ch">])</span><span class="ot">", color="black"</span><span class="ch">)</span><span class="ot"> </span></span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a><span class="ot">      for i in 1:m.</span>p]</span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a>plot(ps...)</span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span></span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a><span class="st">### (b)</span></span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; Perform the model selection and averaging procedure described in Section 9.3. Obtain </span><span class="dt">$Pr</span><span class="st">(</span><span class="ch">\b</span><span class="st">eta_j </span><span class="ch">\n</span><span class="st">eq 0 |y)</span><span class="wa">$,</span><span class="st"> as well as posterior confidence intervals for all of the parameters. Compare to the results in part (a).</span></span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a><span class="wa">$$</span><span class="st">\{y|X_{z(k)},</span><span class="ch">\b</span><span class="st">eta_{z(k)}, </span><span class="ch">\s</span><span class="st">igma^2\} </span><span class="ch">\s</span><span class="st">im </span><span class="ch">\t</span><span class="st">ext{ multivariate normal }(X_{z(k)}</span><span class="ch">\b</span><span class="st">eta_{z(k)}, </span><span class="ch">\s</span><span class="st">igma^2 I)</span><span class="wa">$$</span></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span> {julia}</span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a><span class="ot">m = DiabetesModel</span><span class="ch">(</span><span class="ot">y=y</span>, X=X,  S=<span class="dv">1000</span>)</span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a>function σ²_FCD(<span class="fu">m::DiabetesModel</span>, zs)</span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a>    Xz = <span class="dt">@view</span> <span class="ot">m.X</span><span class="ch">[</span><span class="bn">1:end, Bool.(zs)</span><span class="ch">]</span></span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a><span class="ot">    return σ²_FCD</span><span class="ch">(</span><span class="ot">m.</span>ν₀, <span class="ot">m.σ₀², m.</span>n, Xz, <span class="ot">m.y, m.g</span>)</span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a>function β_FCD(σ², <span class="fu">m::DiabetesModel</span>, zs)</span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a>    Xz  = <span class="dt">@view</span> <span class="ot">m.X</span><span class="ch">[</span><span class="bn">1:end, Bool.(zs)</span><span class="ch">]</span></span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a><span class="ot">    return β_FCD</span><span class="ch">(</span><span class="ot">σ², m.g</span>, Xz, <span class="ot">m.y</span><span class="ch">)</span></span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a><span class="ot">function y_margin</span><span class="ch">(</span><span class="ot">σz², m::DiabetesModel, zs</span><span class="ch">)</span></span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a><span class="ot">    ν₀ = m.</span>ν₀</span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a>    n = <span class="ot">m.n</span></span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a><span class="ot">    y = m.</span>y </span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a>    g = <span class="ot">m.g</span></span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a><span class="ot">    pz = sum</span><span class="ch">(</span><span class="ot">zs</span><span class="ch">)</span></span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true" tabindex="-1"></a><span class="ot">    Xz  = </span><span class="dt">@view</span><span class="ot"> m.</span>X[<span class="dv">1</span>:end, Bool.(zs)]</span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true" tabindex="-1"></a>    ssr = SSR(Xz, <span class="ot">y</span>, g)</span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a>    pyl = -(pz/<span class="dv">2</span>.)<span class="fu">log</span>(<span class="dv">1</span>. +g) + (ν₀/<span class="dv">2</span>.)<span class="dt">*log</span>(σz²) - ((ν₀+n)/<span class="dv">2</span>)<span class="dt">*log</span>((ν₀<span class="wa">*σ</span>z² + ssr))</span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> pyl</span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a>function z_FCD(i , σz², zsmp, nSmp,<span class="fu">m::DiabetesModel</span>)</span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a>    zs = zsmp[nSmp,:]</span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true" tabindex="-1"></a>    pj1 = sum(zsmp[<span class="dv">1</span>:nSmp, i]) / <span class="fu">length</span>(zsmp[<span class="dv">1</span>:nSmp, i])</span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true" tabindex="-1"></a>    pj0 = <span class="dv">1</span>. - pj1</span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a>    pj1_FCD_l =  pj1 <span class="ot">*</span> y_margin(σz², <span class="ot">m, ones</span><span class="ch">(</span><span class="ot">length</span><span class="ch">(</span><span class="ot">zs</span><span class="ch">)))</span></span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a><span class="ot">    pj0_FCD_l =  pj0 </span><span class="ch">*</span><span class="ot"> y_margin</span><span class="ch">(</span><span class="ot">σz²,</span> <span class="ot">m, zs</span><span class="ch">)</span></span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a><span class="ot">    O = exp</span><span class="ch">(</span><span class="ot">pj0_FCD_l - pj1_FCD_l</span><span class="ch">)</span></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a><span class="ot">    return Bernoulli</span><span class="ch">(</span><span class="ot"> 1/</span><span class="ch">(</span><span class="ot">1</span><span class="ch">+</span><span class="ot">O</span><span class="ch">))</span></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a><span class="ot">zsmp = ones</span><span class="ch">(</span><span class="ot">m.S,</span> size(<span class="ot">m.X</span><span class="ch">)[</span><span class="bn">2</span><span class="ch">])</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a><span class="ot">σ²smp = zeros</span><span class="ch">(</span><span class="ot">m.</span>S, <span class="dv">1</span>)</span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a>βsmp = zeros(<span class="ot">m.S, size</span><span class="ch">(</span><span class="ot">m.</span>X)[<span class="dv">2</span>])</span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true" tabindex="-1"></a>σ²smp[<span class="dv">1</span>] = <span class="fl">0.1</span></span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Gibbs sampling</span></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i in <span class="dv">2</span>:<span class="ot">m.S</span></span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a><span class="ot">    for j in Random.s</span>huffle(<span class="dv">1</span>:<span class="ot">m.p</span><span class="ch">)</span></span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a><span class="ot">        zp = z_FCD</span><span class="ch">(</span><span class="ot">j, σ²smp</span><span class="ch">[</span><span class="bn">i-1</span><span class="ch">]</span><span class="ot">, zsmp, i-1, m</span><span class="ch">)</span></span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a><span class="ot">        zsmp</span><span class="ch">[</span><span class="bn">i, j</span><span class="ch">]</span><span class="ot"> = rand</span><span class="ch">(</span><span class="ot">zp</span><span class="ch">)</span></span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a><span class="ot">    end</span></span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a><span class="ot">    σ²smp</span><span class="ch">[</span><span class="bn">i</span><span class="ch">]</span><span class="ot"> = rand</span><span class="ch">(</span><span class="ot">σ²_FCD</span><span class="ch">(</span><span class="ot">m, zsmp</span><span class="ch">[</span><span class="bn">i,:</span><span class="ch">]))</span></span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a><span class="ot">    βsmp</span><span class="ch">[</span><span class="bn">i, Bool.(zsmp[i,:</span><span class="ch">])</span><span class="ot">] = rand</span><span class="ch">(</span><span class="ot">β_FCD</span><span class="ch">(</span><span class="ot">σ²smp</span><span class="ch">[</span><span class="bn">i</span><span class="ch">]</span><span class="ot">, m, zsmp</span><span class="ch">[</span><span class="bn">i,:</span><span class="ch">]))</span></span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a><span class="ot">end</span></span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a><span class="ot">sum</span><span class="ch">(</span><span class="ot">zsmp, dims=1</span><span class="ch">)</span><span class="ot">/size</span><span class="ch">(</span><span class="ot">zsmp</span><span class="ch">)[</span><span class="bn">1</span><span class="ch">]</span></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a><span class="ot">prB = 1.</span> .- <span class="fu">vec</span>(sum(zsmp, dims=<span class="dv">1</span>)).<span class="ot">/size</span><span class="ch">(</span><span class="ot">zsmp</span><span class="ch">)[</span><span class="bn">1</span><span class="ch">]</span></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a><span class="ot">DataFrame</span><span class="ch">(</span><span class="ot">Dict</span><span class="ch">(</span><span class="ot"> "Bi"=&gt; ns, "Pr</span><span class="ch">(</span><span class="ot">Bi != 0 </span><span class="ch">|</span><span class="ot">y</span><span class="ch">)</span><span class="ot">"=&gt; prB </span><span class="ch">))</span></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a><span class="ot">``` {julia}</span></span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a><span class="ot">inds = prB .&gt;= 0.5</span></span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a><span class="ot">b_select = prB</span><span class="ch">[</span><span class="bn">inds</span><span class="ch">]</span></span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a><span class="ot">ps = </span><span class="ch">[</span><span class="bn">histogram(βsmp[:, i</span><span class="ch">]</span><span class="ot">, xlabel="Quantity", </span></span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a><span class="ot">      ylabel="Probability",normalize=true, label="</span><span class="ch">$(</span><span class="ot">ns</span><span class="ch">[</span><span class="bn">i</span><span class="ch">])</span><span class="ot">", color="black"</span><span class="ch">)</span><span class="ot"> </span></span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a><span class="ot">      for i in  findall</span><span class="ch">(</span><span class="ot">inds .== 1</span><span class="ch">)</span><span class="ot">]</span></span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a><span class="ot">plot</span><span class="ch">(</span><span class="ot">ps...</span><span class="ch">)</span></span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span></span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a><span class="ot">``` {julia}</span></span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a><span class="ot">DataFrame</span><span class="ch">(</span><span class="ot">Dict</span><span class="ch">(</span><span class="ot">"Parameters"=&gt; ns</span><span class="ch">[</span><span class="bn">inds</span><span class="ch">]</span><span class="ot">, </span></span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a><span class="ot">               "Confidence interval"=&gt; </span><span class="ch">[</span><span class="bn">quantile(βsmp[:,i</span><span class="ch">]</span><span class="ot">, </span><span class="ch">[</span><span class="bn">0.25, 0.975</span><span class="ch">])</span><span class="ot"> for i in  findall</span><span class="ch">(</span><span class="ot">inds .== 1</span><span class="ch">)</span><span class="ot">]</span><span class="ch">))</span></span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a><span class="ot">```</span></span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a><span class="ch">**</span><span class="ot">Conclusion</span><span class="ch">**</span></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a><span class="ot">There might be some bugs in FCD formulation. The current results show that all the features are equally important after model selection. The distribution is far different from what it is in part </span><span class="ch">(</span><span class="ot">a</span><span class="ch">)</span><span class="ot">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>